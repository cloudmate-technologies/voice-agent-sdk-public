(()=>{"use strict";var t=function(t,n,e,i){return new(e||(e=Promise))((function(r,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function s(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,s)}c((i=i.apply(t,n||[])).next())}))},n=function(t,n){var e,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(e=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],i=0}finally{e=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},e=function(){function e(){this.scriptLoaded=!1,this.scriptElement=null,this.SCRIPT_URL="https://cdn.jsdelivr.net/gh/VapiAI/html-script-tag@latest/dist/assets/index.js",this.init=this.init.bind(this),this.destroy=this.destroy.bind(this)}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.loadScript=function(){return t(this,void 0,void 0,(function(){var t=this;return n(this,(function(n){return this.scriptLoaded?[2]:[2,new Promise((function(n,e){var i=document.createElement("script");i.src=t.SCRIPT_URL,i.defer=!0,i.async=!0,i.onload=function(){t.scriptLoaded=!0,t.scriptElement=i,n()},i.onerror=function(n){t.scriptLoaded=!1,t.scriptElement=null,e(new Error("Failed to load Vapi script: ".concat(n)))},document.head.appendChild(i)}))]}))}))},e.prototype.getElementConfig=function(){var t=document.querySelector("voice-agent");if(!t)throw new Error("Voice agent element not found in the DOM");var n=t.getAttribute("assistant"),e=t.getAttribute("apiKey"),i=t.getAttribute("config");if(!n||!e)throw new Error("Missing required attributes: assistant or apiKey");var r={};if(i)try{r=JSON.parse(i)}catch(t){console.warn("Invalid JSON in config attribute:",t)}return{assistant:n,apiKey:e,config:r}},e.prototype.init=function(){return t(this,void 0,void 0,(function(){var t,e;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),window.vapiInstance?(console.log("Vapi instance already exists, skipping initialization"),[2]):[4,this.loadScript()];case 1:return n.sent(),t=this.getElementConfig(),window.vapiInstance=window.vapiSDK.run(t),[3,3];case 2:throw e=n.sent(),console.error("Failed to initialize Vapi:",e),e;case 3:return[2]}}))}))},e.prototype.destroy=function(){if(window.vapiInstance)try{window.vapiInstance.destroy(),window.vapiInstance=null}catch(t){console.error("Error destroying Vapi instance:",t)}this.scriptElement&&this.scriptElement.parentNode&&(this.scriptElement.parentNode.removeChild(this.scriptElement),this.scriptElement=null,this.scriptLoaded=!1)},e.instance=null,e}();document.addEventListener("DOMContentLoaded",(function(){e.getInstance().init().catch((function(t){console.error("Failed to initialize VoiceAgent:",t)}))})),window.addEventListener("unload",(function(){e.getInstance().destroy()})),window.VoiceAgent=e})();