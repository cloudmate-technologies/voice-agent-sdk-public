(()=>{"use strict";var t=function(t,n,e,i){return new(e||(e=Promise))((function(r,o){function a(t){try{s(i.next(t))}catch(t){o(t)}}function c(t){try{s(i.throw(t))}catch(t){o(t)}}function s(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,c)}s((i=i.apply(t,n||[])).next())}))},n=function(t,n){var e,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=c(0),a.throw=c(1),a.return=c(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(s){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(o=0)),o;)try{if(e=1,i&&(r=2&c[0]?i.return:c[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,c[1])).done)return r;switch(i=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,i=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){o.label=c[1];break}if(6===c[0]&&o.label<r[1]){o.label=r[1],r=c;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(c);break}r[2]&&o.ops.pop(),o.trys.pop();continue}c=n.call(t,o)}catch(t){c=[6,t],i=0}finally{e=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},e=function(){function e(){this.scriptLoaded=!1,this.scriptElement=null,this.SCRIPT_URL="https://cdn.jsdelivr.net/gh/VapiAI/html-script-tag@latest/dist/assets/index.js",this.init=this.init.bind(this),this.destroy=this.destroy.bind(this)}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.waitForSDK=function(t){return void 0===t&&(t=1e4),new Promise((function(n,e){var i=Date.now(),r=function(){window.vapiSDK?n():Date.now()-i>t?e(new Error("Timeout waiting for vapiSDK to load")):setTimeout(r,100)};r()}))},e.prototype.loadScript=function(){return t(this,void 0,void 0,(function(){var t=this;return n(this,(function(n){return this.scriptLoaded?[2]:[2,new Promise((function(n,e){var i=document.querySelector('script[src="'.concat(t.SCRIPT_URL,'"]'));i&&i.parentNode&&i.parentNode.removeChild(i);var r=document.createElement("script");r.src=t.SCRIPT_URL,r.defer=!0,r.async=!0,r.crossOrigin="anonymous",r.onload=function(){t.scriptLoaded=!0,t.scriptElement=r,n()},r.onerror=function(n){t.scriptLoaded=!1,t.scriptElement=null,e(new Error("Failed to load Vapi script: ".concat(n)))},document.head.appendChild(r)}))]}))}))},e.prototype.getElementConfig=function(){var t=document.querySelector("voice-agent");if(!t)throw new Error("Voice agent element not found in the DOM");var n=t.getAttribute("assistant"),e=t.getAttribute("apiKey"),i=t.getAttribute("config");if(!n||!e)throw new Error("Missing required attributes: assistant or apiKey");var r={};if(i)try{r=JSON.parse(i)}catch(t){console.warn("Invalid JSON in config attribute:",t)}return{assistant:n,apiKey:e,config:r}},e.prototype.init=function(){return t(this,void 0,void 0,(function(){var t,e;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),window.vapiInstance?[2]:window.vapiSDK?(t=this.getElementConfig(),window.vapiInstance=window.vapiSDK.run(t),[2]):document.querySelector('script[src="'.concat(this.SCRIPT_URL,'"]'))?[3,2]:[4,this.loadScript()];case 1:n.sent(),n.label=2;case 2:return[4,this.waitForSDK()];case 3:return n.sent(),window.vapiInstance||(t=this.getElementConfig(),window.vapiInstance=window.vapiSDK.run(t)),[3,5];case 4:throw e=n.sent(),console.error("Failed to initialize Vapi:",e),e;case 5:return[2]}}))}))},e.prototype.destroy=function(){},e.instance=null,e}();window.VoiceAgent=e})();