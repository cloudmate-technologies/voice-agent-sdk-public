(()=>{"use strict";var t=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function s(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))},e=function(t,e){var n,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},n=function(){function n(){this.scriptLoaded=!1,this.scriptElement=null,this.SCRIPT_URL="https://cdn.jsdelivr.net/gh/VapiAI/html-script-tag@latest/dist/assets/index.js",this.init=this.init.bind(this),this.destroy=this.destroy.bind(this)}return n.getInstance=function(){return n.instance||(n.instance=new n),n.instance},n.prototype.waitForSDK=function(t){return void 0===t&&(t=1e4),new Promise((function(e,n){var i=Date.now(),r=function(){window.vapiSDK?e():Date.now()-i>t?n(new Error("Timeout waiting for vapiSDK to load")):setTimeout(r,100)};r()}))},n.prototype.loadScript=function(){return t(this,void 0,void 0,(function(){var t=this;return e(this,(function(e){return this.scriptLoaded?[2]:[2,new Promise((function(e,n){var i=document.createElement("script");i.src=t.SCRIPT_URL,i.defer=!0,i.async=!0,i.onload=function(){t.scriptLoaded=!0,t.scriptElement=i,e()},i.onerror=function(e){t.scriptLoaded=!1,t.scriptElement=null,n(new Error("Failed to load Vapi script: ".concat(e)))},document.head.appendChild(i)}))]}))}))},n.prototype.getElementConfig=function(){var t=document.querySelector("voice-agent");if(!t)throw new Error("Voice agent element not found in the DOM");var e=t.getAttribute("assistant"),n=t.getAttribute("apiKey"),i=t.getAttribute("config");if(!e||!n)throw new Error("Missing required attributes: assistant or apiKey");var r={};if(i)try{r=JSON.parse(i)}catch(t){console.warn("Invalid JSON in config attribute:",t)}return{assistant:e,apiKey:n,config:r}},n.prototype.init=function(){return t(this,void 0,void 0,(function(){var t,n,i;return e(this,(function(e){switch(e.label){case 0:if(e.trys.push([0,7,,8]),window.vapiInstance||document.querySelector('voice-agent[data-initialized="true"]'))return console.log("Vapi instance already exists, skipping initialization"),[2];e.label=1;case 1:return e.trys.push([1,3,,6]),[4,this.waitForSDK()];case 2:return e.sent(),[3,6];case 3:return e.sent(),[4,this.loadScript()];case 4:return e.sent(),[4,this.waitForSDK()];case 5:return e.sent(),[3,6];case 6:return t=this.getElementConfig(),window.vapiInstance=window.vapiSDK.run(t),(n=document.querySelector("voice-agent"))&&n.setAttribute("data-initialized","true"),[3,8];case 7:throw i=e.sent(),console.error("Failed to initialize Vapi:",i),i;case 8:return[2]}}))}))},n.prototype.destroy=function(){if(window.vapiInstance)try{window.vapiInstance.destroy(),window.vapiInstance=null}catch(t){console.error("Error destroying Vapi instance:",t)}this.scriptElement&&this.scriptElement.parentNode&&(this.scriptElement.parentNode.removeChild(this.scriptElement),this.scriptElement=null,this.scriptLoaded=!1)},n.instance=null,n}();window.VoiceAgent=n})();